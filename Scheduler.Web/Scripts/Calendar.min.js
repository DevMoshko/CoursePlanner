function GUID(){var n=function(){return Math.floor(Math.random()*65536).toString(16)};return n()+n()}function Calendar(n,t,i){var r,u;for(this.items={},this.placeholder=n,this.parent=t,this.name=i,this.placeholder.innerHTML=this.getBaseCalendar(),this.itemSlot=new Array(5),this.tempItem=[],r=0;r<5;r++)for(this.itemSlot[r]=new Array(96),u=0;u<96;u++)this.itemSlot[r][u]=[];$(".timeGrid").width(($(this.placeholder).width()-40)/5)}function CalendarCollection(n,t){this.placeholder=n,this.list=t,this.splitted=!0,$(n).append("<div id='calendarControlBar' class='widgetTitle2'><div id='downloadIcs' class='calendarControls hasTooltip' data-tooltip='Export iCal'>Export to iCal<\/div><div id='shareLink' class='calendarControls hasTooltip' data-tooltip='Share Calendar'>Share Timetable<\/div><div id='splittedView' class='calendarControls selected'>Splitted<\/div><div id='winterView' class='calendarControls'>Winter<\/div><div id='fallView' class='calendarControls'>Fall<\/div><\/div>"),$(n).append("<div id='fallCalendar' class='singleCalendar splitted'><\/div>"),$(n).append("<div id='winterCalendar' class='singleCalendar splitted'><\/div>"),this.fallCalendar=new Calendar($("#fallCalendar")[0],this,"Fall"),this.winterCalendar=new Calendar($("#winterCalendar")[0],this,"Winter"),$("#fallView").click(function(){$(this.fallCalendar.placeholder).hide(),$(this.winterCalendar.placeholder).hide(),$(".calendarControls.selected").removeClass("selected"),$("#fallView").addClass("selected"),$(this.fallCalendar.placeholder).show("slide",200,function(){this.splitted=!1,this.resize()}.bind(this))}.bind(this)),$("#winterView").click(function(){$(this.fallCalendar.placeholder).hide(),$(this.winterCalendar.placeholder).hide(),$(".calendarControls.selected").removeClass("selected"),$("#winterView").addClass("selected"),$(this.winterCalendar.placeholder).show("slide",200,function(){this.splitted=!1,this.resize()}.bind(this))}.bind(this)),$("#splittedView").click(function(){$(this.fallCalendar.placeholder).hide(),$(this.winterCalendar.placeholder).hide(),$(".calendarControls.selected").removeClass("selected"),$("#splittedView").addClass("selected"),$(this.winterCalendar.placeholder).show("slide",200),$(this.fallCalendar.placeholder).show("slide",200,function(){this.splitted=!0,this.resize()}.bind(this))}.bind(this)),$("#downloadIcs").click(function(){var n=this.getAllSectionsString();$("#hiddenDownloader").attr("src","Handlers/ICalHandler.ashx?Courses="+n)}.bind(this)),$("#shareLinkDropDown").css("top",$("#shareLink").offset().top+35),$("#shareLinkDropDown").css("left",$("#shareLink").offset().left),$("#shareLinkDropDown").hide(),$("#shareLink").toggle(function(){$("#shareLink").addClass("selected");var n="http://griddy.org?link="+this.getAllSectionsString();$("#shareLinkText").val(n),$("#rrLink").attr("href","http://widget.renren.com/dialog/share?resourceUrl="+n+"&srcUrl="+n+"&title=My timetable&description="+Base64.decode(this.getAllSectionsString())),$("#wbLink").attr("href","http://service.weibo.com/share/share.php?title=My%20Timetable&url="+n+"&source=bookmark"),$("#twLink").attr("href","https://twitter.com/share?url="+n),$("#fbLink").attr("href","https://www.facebook.com/sharer/sharer.php?u="+n),$("#shareLinkDropDown").show(200)}.bind(this),function(){$("#shareLink").removeClass("selected"),$("#shareLinkDropDown").hide(200)}),$("#shareLinkText").focus(function(){$(this).select()})}Function.prototype.bind||(Function.prototype.bind=function(n){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var r=Array.prototype.slice.call(arguments,1),u=this,t=function(){},i=function(){return u.apply(this instanceof t&&n?this:n,r.concat(Array.prototype.slice.call(arguments)))};return t.prototype=this.prototype,i.prototype=new t,i}),Array.prototype.indexOf||(Array.prototype.indexOf=function(n){"use strict";var u,r,t,i;if(this===void 0||this===null)throw new TypeError;if((u=Object(this),r=u.length>>>0,r===0)||(t=0,arguments.length>0&&(t=Number(arguments[1]),t!==t?t=0:t!==0&&t!==Infinity&&t!==-Infinity&&(t=(t>0||-1)*Math.floor(Math.abs(t)))),t>=r))return-1;for(i=t>=0?t:Math.max(r-Math.abs(t),0);i<r;i++)if(i in u&&u[i]===n)return i;return-1}),Calendar.prototype.addItem=function(n){var u,r,t,f,i,e;if($(".t"+(n.StartTime-32)).position()){for(n.UID=GUID(),u=n.Time.split(" "),parsedTime=u[2*n.Order+1],t="",r="",n.Location&&(t=n.Location.split(" "),r=t[n.Order]),f=n.UID,this.items[f]=n,i=n.StartTime;i<n.EndTime;i++)this.itemSlot[n.Day-1][i].push(n);this.refreshDivision(n),e="<div class='calendarItem course"+n.CourseID+" cal"+n.ID+" "+n.Campus+"' id='"+n.UID+"'><div class='itemInfo'><b>"+n.Abbr+"<\/b><br />"+parsedTime+"<br/>@ "+r+"<\/div><\/div>",$(this.placeholder).find(".calendarContentWrapper").append(e),this.resize(),$("#"+n.UID).hover(function(){$(".cal"+n.ID).each(function(){$(this).addClass("hover")})},function(){$(".cal"+n.ID).each(function(){$(this).removeClass("hover")})}),$("#"+n.UID).click(function(n){$("#listItem"+this.items[$(n.delegateTarget).attr("id")].CourseID).click()}.bind(this))}},Calendar.prototype.removeItem=function(n){for(var u=$(this.placeholder).find(".cal"+n),t,r,f,i=0;i<u.length;i++){for(t=$(u[i]).attr("id"),r=this.items[t].StartTime;r<this.items[t].EndTime;r++)f=this.itemSlot[this.items[t].Day-1][r],f.splice(f.indexOf(this.items[t]),1);delete this.items[t]}u.remove(),$("#calItemInfo").hide(),this.resize()},Calendar.prototype.removeCourse=function(n){for(var u=$(this.placeholder).find(".course"+n),t,r,f,i=0;i<u.length;i++){for(t=$(u[i]).attr("id"),r=this.items[t].StartTime;r<this.items[t].EndTime;r++)f=this.itemSlot[this.items[t].Day-1][r],f.splice(f.indexOf(this.items[t]),1);delete this.items[t]}u.remove(),$("#calItemInfo").hide(),this.resize()},Calendar.prototype.getBaseCalendar=function(){var n="<table><tr class='calendarHeader'><td class='name'>"+this.name+"<\/td><td class='w0 timeGrid'>Mon<\/td><td class='w1 timeGrid'>Tue<\/td><td class='w2 timeGrid'>Wed<\/td><td class='w3 timeGrid'>Thu<\/td><td class='w4 timeGrid'>Fri<\/td><\/tr><\/table>",t,i;for(n+="<div class='calendarContentStatic'><div class='calendarContentWrapper'>",n+="<table class='calendarContent'>",t=0;t<=56;t++){if(n+="<tr class='t"+t+(t%4==0?" line":"")+"'>",t%4==0)for(n+="<td class='timeDisplay' rowspan='4'>",n+=t/4+8+":00",n+="<\/td>",i=0;i<5;i++)n+="<td class='line'><\/td>";else for(i=0;i<5;i++)n+="<td><\/td>";n+="<\/tr>"}return n+"<\/table><\/div><\/div>"},Calendar.prototype.refreshDivision=function(n){for(var u=0,e={},f,r,t,i=n.StartTime;i<n.EndTime;i++){t=this.itemSlot[n.Day-1][i],f=0;for(r in t)t[r].UID&&t[r].UID!==n.UID&&(e[t[r].HPosition]=!0,t[r].Division=t.length,f++);f>u&&(u=f)}for(n.Division=u+1,t=0,i=0;i<=u;i++)e[i]||(t=i);n.HPosition=t},Calendar.prototype.resize=function(){var i,n;$(this.placeholder).find(".calendarContentStatic").height($(this.placeholder).height()-35),i=$(this.placeholder).find(".timeGrid"),i.width(($(this.placeholder).width()-60)/5),$(this.placeholder).find("td.line").width(($(this.placeholder).width()-60)/5),$(this.placeholder).find(".timeDisplay").width($(this.placeholder).find(".name").width());for(n in this.items){var t=$("#"+n),r=$(this.placeholder).find(".t"+(this.items[n].StartTime-32)).position().top,f=$(this.placeholder).find(".t"+(this.items[n].EndTime-32)).position().top,e=f-r-3;this.refreshDivision(this.items[n]);var u=(i.width()-10)/this.items[n].Division,o=$(this.placeholder).find(".w"+(this.items[n].Day-1)),s=o.position().left-2+u*this.items[n].HPosition;t.width(u-5),t.height(e),t.css("left",s),t.css("top",r),this.items[n].Division>1?t.addClass("conflict"):t.hasClass("conflict")&&t.removeClass("conflict")}},Calendar.prototype.isConflicted=function(n){for(var i=this.hasItem(n),t=n.StartTime;t<n.EndTime;t++)if(this.itemSlot[n.Day-1][t].length>0&&!i||this.itemSlot[n.Day-1][t].length>1)return!0;return!1},Calendar.prototype.hasItem=function(n){return $(this.placeholder).find(".cal"+n.ID).length>0},Calendar.prototype.tempAdd=function(n){this.tempItem.push(n),this.addItem(n)},Calendar.prototype.tempRemove=function(){this.onTempAnimation=!1;for(var n in this.tempItem)this.removeItem(this.tempItem[n].ID);this.tempItem=[]},Calendar.prototype.highlight=function(n){$(this.placeholder).children(".highlight").removeClass("highlight"),$(this.placeholder).children(".course"+n).addClass("highlight")},Calendar.prototype.scrollForItem=function(n){if(this.hasItem(n)){var t=$(".cal"+n.ID).position().top;($(this.placeholder).find(".calendarContentStatic").scrollTop()>t||$(this.placeholder).height()+$(this.placeholder).scrollTop()-40<t)&&$(this.placeholder).find(".calendarContentStatic").animate({scrollTop:t},300)}},Calendar.prototype.getSelectedSlot=function(){},Calendar.prototype.getChildItem=function(n){return $(this.placeholder).children(".cal"+n)},CalendarCollection.prototype.resize=function(){$(".singleCalendar").height($(this.placeholder).height()-40),this.splitted?$(".singleCalendar").width($(this.placeholder).width()/2-10):$(".singleCalendar").width($(this.placeholder).width()-10),this.fallCalendar.resize(),this.winterCalendar.resize()},CalendarCollection.prototype.addItem=function(n){(n.Semester=="F"||n.Semester=="Y")&&this.fallCalendar.addItem(n),(n.Semester=="S"||n.Semester=="Y")&&this.winterCalendar.addItem(n)},CalendarCollection.prototype.removeItem=function(n){this.fallCalendar.removeItem(n),this.winterCalendar.removeItem(n)},CalendarCollection.prototype.tempAdd=function(n){(n.Semester=="F"||n.Semester=="Y")&&this.fallCalendar.tempAdd(n),(n.Semester=="S"||n.Semester=="Y")&&this.winterCalendar.tempAdd(n)},CalendarCollection.prototype.tempRemove=function(){this.fallCalendar.tempRemove(),this.winterCalendar.tempRemove()},CalendarCollection.prototype.isConflicted=function(n){return(n.Semester==="F"||n.Semester==="Y")&&this.fallCalendar.isConflicted(n)?!0:(n.Semester==="S"||n.Semester==="Y")&&this.winterCalendar.isConflicted(n)?!0:!1},CalendarCollection.prototype.hasItem=function(n){return this.fallCalendar.hasItem(n)||this.winterCalendar.hasItem(n)},CalendarCollection.prototype.highlight=function(n){this.fallCalendar.highlight(n),this.winterCalendar.highlight(n)},CalendarCollection.prototype.scrollForItem=function(n){this.fallCalendar.scrollForItem(n),this.winterCalendar.scrollForItem(n)},CalendarCollection.prototype.getAllSectionsString=function(){var n="",t={};return $.each(this.fallCalendar.items,function(i,r){t[r.ID]||(n!==""&&(n+=","),n+=r.Abbr,t[r.ID]=r)}),$.each(this.winterCalendar.items,function(i,r){t[r.ID]||(n!==""&&(n+=","),n+=r.Abbr,t[r.ID]=r)}),Base64.encode(n)},CalendarCollection.prototype.removeCourse=function(n){this.fallCalendar.removeCourse(n),this.winterCalendar.removeCourse(n)};
//@ sourceMappingURL=Calendar.min.js.map